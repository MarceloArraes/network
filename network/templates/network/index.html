{% extends "network/layout.html" %}

{% block body %}



<div id="initial">Teste</div>



<script type="text/babel">

    //React aqui pega o conte√∫do do HTML da postagem para salvar
    class Timeline extends React.Component {
        render() {
            return (
                < div className="list-group-item list-group-item-action">
                    <div>Post list by timestamp</div>
                    <div id="postlist" ></div>
                </div >
            );
        }
        componentDidMount() {
            return this.listposts()
        }
        listposts = (event) => {
            // Fazer um fetch e chamar o show posts
            fetch('/showposts')
                .then(response => response.json())
                .then(data => {
                    console.log(data)
                    data.forEach(element => {
                        posting_posts(element)
                    });;
                });
            function posting_posts(posts) {
                const post = document.createElement('div');
                post.className = "list-group-item list-group-item-action";
                post.innerHTML = `<div>${posts.user}</div><div>${posts.content}</div><div>${posts.timestamp}</div>`;
                document.querySelector('#postlist').append(post);
            }
        }
    }
    class Compose extends React.Component {
        constructor(props) {
            super(props);
            this.state = {
                postuser: "",
                content: "",
            };
        }
        render() {
            return (
                <div className="list-group-item list-group-item-action">
                    <div><h2>Post:</h2></div>
                    <div><input id='content' type="text" onChange={this.updateContent} /></div>
                    <div><input onClick={this.submitButtonPress} value='Submit' type="button" /></div>
                    <div>{this.state.content}</div>
                </div>

            );
        }
        submitButtonPress = (event) => {
            //const userr = this.dataset.section;

            console.log("button Clicked");
            console.log(`Content: ${this.state.content}`);
            const userr = document.querySelector('#userr').innerHTML;
            const contentt = this.state.content;
            console.log(userr)
            console.log("entenred the saving post")
            fetch('/posts', {
                method: 'POST',
                body: JSON.stringify({
                    postuser: userr,
                    content: contentt,
                })
            })
                .then(response => response.json())
                .then(result => {
                    console.log(result)
                    fetch("", {
                        method: 'GET'
                    })
                });

        }
        updateContent = (event) => {
            this.setState({
                content: event.target.value
            })
        }
    }


    class Initial extends React.Component {

        render() {
            return (
                <div>
                    <Compose />
                    <dir></dir>
                    <div><Timeline /></div>
                </div>
            );
        }

    }
    ReactDOM.render(<Initial />, document.querySelector('#initial'));
</script>
{% endblock %}